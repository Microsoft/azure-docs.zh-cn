---
title: Azure VM 上适用于 SQL Server 的 SQL 漏洞评估
description: 介绍适用于 Azure 虚拟机上运行的 SQL Server 数据库的 SQL 漏洞评估。
services: virtual-machines-windows
author: MashaMSFT
ms.service: virtual-machines-sql
ms.subservice: security
ms.topic: conceptual
ms.tgt_pltfrm: vm-windows-sql-server
ms.workload: iaas-sql-server
ms.date: 12/02/2020
ms.author: mathoma
ms.openlocfilehash: 817203b8e795ce15c8c48c18bc7b9a46217dc93a
ms.sourcegitcommit: 772eb9c6684dd4864e0ba507945a83e48b8c16f0
ms.translationtype: HT
ms.contentlocale: zh-CN
ms.lasthandoff: 03/19/2021
ms.locfileid: "97356697"
---
# <a name="sql-vulnerability-assessment-for-sql-server-on-azure-vms"></a>Azure VM 上适用于 SQL Server 的 SQL 漏洞评估
[!INCLUDE[appliesto-sqlvm](../../includes/appliesto-sqlvm.md)]

SQL 漏洞评估 (VA) 是一项易于配置的服务，可以发现、跟踪并帮助修正潜在的数据库漏洞。 使用它可主动提高 Azure VM 上的 SQL Server 的数据库安全性。 

漏洞评估是 [Azure Defender for SQL](../../database/azure-defender-for-sql.md) 产品/服务（高级 SQL 安全功能的统一包）的一部分。 可通过中心 Azure Defender for SQL 门户或 Azure 安全中心访问和管理漏洞评估。 

## <a name="overview"></a>概述

SQL 漏洞评估 (VA) 是提供安全状态见解的服务。 漏洞评估包括用于解决安全问题和增强数据库安全性的可行步骤。 此工具有助于： 

- 满足必须生成数据库扫描报告的符合性要求。 
- 满足数据隐私标准。 
- 监视变化难以跟踪的动态数据库环境。 

漏洞评估是一种扫描服务，它使用标记安全漏洞的规则知识库。 它会重点列出违背最佳做法的情况，例如配置不当、权限过度分配以及敏感数据未受保护。 

这些规则基于 Microsoft 的最佳做法，并专注于对数据库及其重要数据有最大风险的安全问题。 它们涵盖了数据库级别的问题以及服务器级别的安全问题，例如服务器防火墙设置和服务器级别的权限。 这些规则还体现了各个监管机构提出的许多要求，旨在满足它们的符合性标准。 

扫描结果包括旨在解决每个问题的可操作步骤，并提供自定义修正脚本（若适用）。 可以通过设置以下各项的可接受基线，来为环境自定义评估报告： 

- 权限配置 
- 功能配置 
- 数据库设置 

## <a name="enable-sql-va"></a>启用 SQL VA

在计算机上启用 Azure Defender for SQL Server，以实现漏洞评估。 

要使用 Azure Defender for SQL Server，请执行以下步骤：

1. [安装 SQL IaaS 代理扩展](sql-agent-extension-manually-register-single-vm.md)
1. [启用 Log Analytics 代理的自动预配](../../../security-center/security-center-enable-data-collection.md#auto-provision-mma)
1. [启用可选的安全中心计划](../../../security-center/defender-for-sql-usage.md#step-2-enable-the-optional-plan-in-security-centers-pricing-and-settings-page)

因为漏洞评估是 Azure Defender for SQL 的一部分，所以在虚拟机上启用 Azure Defender 后，将每隔 12 小时自动扫描一次数据库，以识别安全漏洞。 结果会发送到 Azure 安全中心，以形成由 Azure Defender for SQL 保护的 SQL 数据资产的集中聚合视图。 

> [!NOTE]
> 扫描是轻量级且安全的，每个数据库只需几秒钟即可运行，并且完全是只读的。 此功能不会对数据库做出任何更改。 

## <a name="view-report"></a>查看报表

数据库报表提供安全状态的概况。 其中会列出发现的问题个数及其各自的严重性。 结果包括未遵循最佳做法的警告，以及安全相关设置（例如数据库主体和角色及其相关权限）的快照。  

要查看该报表，请执行以下步骤：

1. 转到 Azure 门户中的 [Azure 安全中心](https://ms.portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/0)。
1. 在“常规”菜单中选择“建议” ： 

   :::image type="content" source="media/sql-vulnerability-assessment-enable/recommendations-in-security-center.png" alt-text="从 Azure 门户转到 Azure 安全中心内“设置”下的“建议”":::

1. 向下滚动到建议，然后展开“修正漏洞”。
1. 选择“应修正关于计算机上 SQL 服务器的漏洞评估结果”。 

   :::image type="content" source="media/sql-vulnerability-assessment-enable/report-in-security-center.png" alt-text="在 Azure 安全中心的“建议”边栏选项卡中查看报表":::

此页显示针对订阅中的所有 SQL Server VM 识别到的安全漏洞汇总。 


## <a name="analyze-results"></a>分析结果

查看结果，并确定报表中的哪些结果是环境中真实存在的安全问题。 深入查看每个失败的结果，了解该结果的影响，以及每个安全检查失败的原因。  

:::image type="content" source="media/sql-vulnerability-assessment-enable/sample-report.png" alt-text="查看结果，并确定报表中的哪些结果是环境中真实存在的安全问题。":::

## <a name="set-baseline"></a>设置基线 

在查看评估结果时，可将结果标记为环境中可接受的基线。 基线其实就是自定义结果的报告方式。 与基线匹配的结果被视为通过后续扫描。 建立基线安全状态后，漏洞评估只会报告与基线的偏差。 这样，你可以专注于处理相关问题。 

:::image type="content" source="media/sql-vulnerability-assessment-enable/analyze-report-for-details.png" alt-text="在查看评估结果时，可将结果标记为环境中可接受的基线。":::

## <a name="export-results"></a>导出结果

使用 Azure 安全中心的[连续导出](../../../security-center/continuous-export.md)功能，将漏洞评估结果导出到 Azure 事件中心或 Log Analytics 工作区。 


## <a name="next-steps"></a>后续步骤

要了解详细信息，请参阅 [Azure SQL 中的 SQL 漏洞评估](../../database/sql-vulnerability-assessment.md)和[使用 Azure 安全中心保护 SQL 数据](../../../security-center/security-center-introduction.md)。

