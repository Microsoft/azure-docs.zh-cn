---
title: VM 见解来宾运行状况警报（预览）
description: 介绍由 VM insights 来宾运行状况创建的警报，包括如何启用和配置通知。
ms.topic: conceptual
author: bwren
ms.author: bwren
ms.date: 11/10/2020
ms.openlocfilehash: 9c4b15fa2a8be32aa7397ae425f28f1deaac6b71
ms.sourcegitcommit: f28ebb95ae9aaaff3f87d8388a09b41e0b3445b5
ms.translationtype: HT
ms.contentlocale: zh-CN
ms.lasthandoff: 03/30/2021
ms.locfileid: "105024602"
---
# <a name="vm-insights-guest-health-alerts-preview"></a>VM 见解来宾运行状况警报（预览）
利用 VM 见解来宾运行状况，可以查看虚拟机的运行状况，该运行状况由一组定期取样的性能测量值定义。 可以在虚拟机或监视器变为不正常状态时创建警报。 可以使用 [Azure Monitor 中创建的警报规则](../alerts/alerts-overview.md)来查看和管理这些警报，并选择在有新警报创建时主动接收通知。

## <a name="configure-alerts"></a>配置警报
不能为 VM 见解来宾运行状况创建显式警报规则，此功能尚处于预览状态。 默认为每个虚拟机（而不是每个监视器）创建警报。  这意味着，如果监视器更改后的状态不影响虚拟机的当前状态，则不会创建任何警报，因为虚拟机状态没有变化。 

要禁用特定虚拟机或虚拟机上特定监视器的警报，可在 Azure上该虚拟机配置的“警报状态”设置中进行设定。 有关在 Azure 门户中配置监视器的详细信息，请参阅[在 VM 见解来宾运行状况中配置监视（预览版）](vminsights-health-configure.md)。 有关在一组虚拟机中配置监视器的详细信息，请参阅[使用数据收集规则在 VM 见解来宾运行状况中配置监视（预览版）](vminsights-health-configure-dcr.md)。

## <a name="alert-severity"></a>警报严重性
来宾运行状况创建的警报的严重性会直接映射到触发警报的虚拟机或监视器的严重性。

| 监视器状态 | 警报严重性 |
|:---|:---|
| 严重 | Sev1 |
| 警告  | Sev2 |
| 正常  | Sev4 |

## <a name="alert-lifecycle"></a>警报生命周期
每个虚拟机在变为“警告”或“严重”状态时，系统都将为之创建一个 [Azure 警报](../alerts/alerts-overview.md)。 从 Azure 门户的 Azure Monitor 菜单或虚拟机菜单的“警报”中可查看警报 。

如果虚拟机在状态变化时警报已处于“已触发”状态，则不会再创建第二个警报，但同一警报的严重性会发生变化，以与虚拟机的状态相符。 例如，如果虚拟机在“警告”警报处于“已触发”状态的情况下变为“严重”状态，则警报严重性将变为“Sev1”   。 例如，如果虚拟机在“Sev1”警报处于“已触发”状态的情况下变为“警告”状态，则警报严重性将变为“Sev2”   。 如果虚拟机恢复“正常”状态，则会解除警报，同时严重性将更改为“Sev4”。

## <a name="viewing-alerts"></a>查看警报
在 Azure 门户中查看 VM 见解来宾运行状况创建的警报以及其他[警报](../alerts/alerts-overview.md#alerts-experience)。 可以从 Azure Monitor 菜单中选择“警报”来查看所有受监视资源的警报，也可以从虚拟机菜单中选择“警报”，仅查看该虚拟机的警报。

## <a name="alert-properties"></a>警报属性

### <a name="properties-in-the-azure-portal"></a>Azure 门户中的属性
下表描述了在 Azure 门户中查看警报时所见到警报的属性。

| 属性 | 说明 |
|:---|:---|
| 创建警报之前的监视器状态 | 第一次触发此警报之前监视器或虚拟机的状态。 |
| 创建警报时的监视器状态 | 第一次触发此警报时监视器或虚拟机的状态。 这是导致触发警报的状态。 |
| 了解有关创建警报时状态转换的详细信息 | 链接到“VM 运行状况”页，从中可查看准确的状态转换信息。 此状态转换代表监视器第一次从正常状态变为不正常状态时的实例。 |

例如，监视器在时间 t0 从“正常”转变为“严重” ，则会触发一个 Sev1 新警报。 然后，它在时间 t1 从“严重”转变为“警告” ，则警报严重性将更新为 Sev2。 它在时间 t2 又变成“正常”状态，则警报将解除。

在整个序列中，警报属性包含这些值。

- 创建警报之前的监视器状态：正常
- 创建警报时的监视器状态：严重
- 了解有关创建警报时状态转换的详细信息：导航链接到在时间 t0 发生的状态转换。


### <a name="properties-in-notifications"></a>通知中的属性
下表描述了通知中包含的警报属性。

| 属性 | 说明 |
|:---|:---|
| 以前的监视器状态 | 状态变化前的监视器或虚拟机状态。 如果警报严重性更新触发了此通知，则此属性表示严重性更新之前的状态。 |
| 当前监视器状态 | 状态改变后的监视器或虚拟机状态。 如果警报严重性更新触发了此通知，则此属性表示新状态。 |
| 了解有关此状态转换的详细信息 | 链接到“VM 运行状况”页，从中可查看准确的状态转换信息。 此状态转换表示监视器已改变之前触发此通知的状态的实例。 |

使用上述示例，每次通知都将具有以下属性。

在时间 t0 收到的通知
- 以前的监视器状态：正常
- 当前监视器状态：严重
- 了解有关状态转换的详细信息：导航链接到在时间 t0 发生的状态转换。

在时间 t1 收到的通知
- 以前的监视器状态：严重
- 当前监视器状态：警告
- 了解有关状态转换的详细信息：导航链接到在时间 t1 发生的状态转换。

在时间 t2 收到的通知
- 以前的监视器状态：警告
- 当前监视器状态：正常
- 了解有关状态转换的详细信息：导航链接到在时间 t2 发生的状态转换。

## <a name="configure-notifications"></a>配置通知
要主动接收来宾运行状况触发的警报通知，可创建一个[操作组](../alerts/action-groups.md)来定义要执行的不同操作，例如发送 SMS 消息或启动逻辑应用。 然后，创建一个[操作规则](../alerts/alerts-action-rules.md)，指定监视器和虚拟机的范围，并使用该操作组。

在 Azure 门户的“监视”菜单中，选择“警报”。  依次选择“管理操作”和“操作规则（预览版）” 。 

![新建操作规则](media/vminsights-health-alerts/action-rule-new.png)

单击“新建操作规则”可创建新规则。 单击范围旁边的“选择”，并选择订阅、资源组或一个或多个特定虚拟机。 仅对位于此范围内的虚拟机触发通知。

![操作规则范围](media/vminsights-health-alerts/action-rule-scope.png)

单击“筛选器”旁边的“添加” 。 创建一个筛选器，其中“监视器服务 = VM 见解 - 运行状态”。 添加其他筛选器，用来指定应触发通知的特定警报。 例如，可以使用“严重性”来匹配所有监视器中与特定严重性匹配的警报。

![操作规则筛选器](media/vminsights-health-alerts/action-rule-filter.png)

在“对此范围定义”中，选择“操作组”，然后选择要与监视器关联的操作组。 为规则命名，并选择应将其保存到的资源组。 单击“创建”以创建规则。

![操作规则](media/vminsights-health-alerts/action-rule.png)


## <a name="next-steps"></a>后续步骤

- [启用 VM 见解来宾运行状况和载入代理。](vminsights-health-enable.md)
- [使用 Azure 门户配置监视器。](vminsights-health-configure.md)
- [使用数据收集规则配置监视器。](vminsights-health-configure-dcr.md)