---
title: Azure 前门标准/高级版中的源组和源组
description: 本文介绍 Azure 前门配置中的源组和源组。
services: frontdoor
author: duongau
ms.service: frontdoor
ms.topic: conceptual
ms.date: 02/18/2021
ms.author: duau
ms.openlocfilehash: 42a9a0ea23faa481140a46ec52b2214431dd723e
ms.sourcegitcommit: 97c48e630ec22edc12a0f8e4e592d1676323d7b0
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 02/18/2021
ms.locfileid: "101098752"
---
# <a name="origin-and-origin-group-in-azure-front-door-standardpremium-preview"></a>Azure 前门标准/高级 (预览版中的源和源组) 

> [!Note]
> 本文档适用于 Azure 前门标准/高级 (预览版) 。 正在寻找有关 Azure 前门的信息？ 查看 [此处](../front-door-overview.md)。

本文介绍有关如何使用 Azure 前门标准/高级版来部署 web 应用程序的概念。 你还将了解 *源* 和 *源组* 在 Azure 前门标准/高级配置中的内容。

> [!IMPORTANT]
> Azure 前门标准/高级 (预览版) 目前为公共预览版。
> 此预览版在提供时没有附带服务级别协议，不建议将其用于生产工作负荷。 某些功能可能不受支持或者受限。
> 有关详细信息，请参阅 [Microsoft Azure 预览版补充使用条款](https://azure.microsoft.com/support/legal/preview-supplemental-terms/)。

## <a name="origin"></a>源

Azure 前门标准/高级源指的是为客户端请求提供服务的应用程序的主机名或公共 IP。 Azure 前门标准/高级版支持源组中的 Azure 和非 Azure 资源。 还可以在本地数据中心或其他云提供程序中托管该应用程序。 不应将源与数据库层或存储层混淆。 应将源视为应用程序后端的公共终结点。 将源添加到 Azure 前门标准/高级源组时，还必须添加以下信息：

* **源类型：** 要添加的资源的类型。 前门支持从应用服务、云服务或存储中自动发现应用程序后端。 如果需要 Azure 中的其他资源，甚至是非 Azure 后端，请选择 " **自定义主机**"。

    >[!IMPORTANT]
    >在配置过程中，如果无法从前门环境访问源，则 Api 不会进行验证。 请确保前门可以到达原点。

* **订阅和源主机名：** 如果没有为后端主机类型选择 " **自定义主机** "，请选择相应的订阅和相应的后端主机名，选择后端。

* **源主机标头：** 为每个请求发送到后端的主机标头值。 有关详细信息，请参阅 [源主机标头](#hostheader)。

* **优先级：** 如果要对所有流量使用主源，请将优先级分配给不同的源。 此外，如果主副本或备份源不可用，则提供备份。 有关详细信息，请参阅 [Priority](#priority)。

* **权重：** 将权重分配给不同的源，以便在一组来源之间分配流量，不管是平均分配还是根据权重系数分配流量。 有关详细信息，请参阅 [权重](#weighted)。

### <a name="origin-host-header"></a><a name = "hostheader"></a>源主机标头

由 Azure 前门标准/高级版转发到源的请求将包含一个主机标头字段，源将使用该字段来检索目标资源。 此字段的值通常来自具有主机标头和端口的源 URI。

例如，对发出的请求 `www.contoso.com` 将具有主机标头 `www.contoso.com` 。 如果使用 Azure 门户来配置源，则此字段的默认值为后端的主机名。 如果源为 `contoso-westus.azurewebsites.net` ，则在 Azure 门户中，源主机标头的会自动填充值将为 `contoso-westus.azurewebsites.net` 。 但是，如果使用 Azure 资源管理器模板或其他方法而不显式设置此字段，前门会将传入的主机名作为主机标头的值发送。 如果对发出了请求 `www.contoso.com` ，并且您的来源为 `contoso-westus.azurewebsites.net` 空的标头字段，则前门会将主机标头设置为 `www.contoso.com` 。

大多数应用后端 (Azure Web 应用、Blob 存储和云服务) 需要主机标头来匹配后端的域。 但是，路由到后端的前端主机将使用不同的主机名，例如 `www.contoso.net` 。

如果源需要主机标头以匹配后端主机名，请确保后端主机标头包含后端的主机名。

#### <a name="configuring-the-origin-host-header-for-the-origin"></a>为源配置源主机头

为源组部分中的源配置 **源主机标头** 字段：

1. 打开前门资源并选择要配置的源组。

2. 如果尚未执行此操作，请添加源，或编辑现有源。

3. 将 "源主机标头" 字段设置为自定义值，或将其留空。 传入请求的主机名将用作主机标头值。

## <a name="origin-group"></a>源组

Azure 前门标准/高级版中的源组是指接收其应用程序的类似流量的来源集。 换句话说，它是全球范围内的应用程序实例的逻辑分组，可接收相同的流量并响应预期的行为。 可以在不同的区域或同一区域内部署这些来源。 所有来源都可以处于主动/主动部署模式，或定义为主动/被动配置。

源组定义了应如何通过运行状况探测来计算来源。 它还定义了负载平衡之间的发生方式。

### <a name="health-probes"></a>运行状况探测

Azure 前门标准/高级版向每个已配置的来源发送定期 HTTP/HTTPS 探测请求。 探测请求会确定每个源的邻近性和运行状况，以对最终用户请求进行负载平衡。 源组的运行状况探测设置定义我们如何轮询 app 后端的运行状况状态。 以下设置可用于负载平衡配置：

* **路径**：用于对源组中的所有来源的探测请求的 URL。 例如，如果你的一个来源为， `contoso-westus.azurewebsites.net` 路径设置为/probe/test.aspx，而前门环境（假定协议为 HTTP）将向发送运行状况探测请求 `http://contoso-westus.azurewebsites.net/probe/test.aspx` 。

* **协议**：定义是否通过 HTTP 或 HTTPS 协议将运行状况探测请求从前门发送到源。

* **方法**：用于发送运行状况探测的 HTTP 方法。 选项包括 GET 或 HEAD (默认) 。
    > [!NOTE]
    > 为了降低负载并降低后端成本，前门建议使用 HEAD 请求进行运行状况探测。

* **间隔 (秒)**：定义运行状况探测的频率，或每个前端环境发送探测的间隔。

    >[!NOTE]
    >为了更快地进行故障转移，请将间隔设置为较小的值。 值越低，后端接收到的运行状况探测量就越高。 例如，如果将时间间隔设置为30秒（例如，100前门），则每个后端将每分钟收到约200探测请求。

有关详细信息，请参阅 [运行状况探测](concept-health-probes.md)。

### <a name="load-balancing-settings"></a>负载平衡设置

源组的负载平衡设置定义我们评估运行状况探测的方式。 这些设置确定源是正常还是不正常。 它们还会检查如何在源组中的不同来源之间对流量进行负载均衡。 以下设置可用于负载平衡配置：

* **样本大小：** 确定对于源运行状况评估需要考虑的运行状况探测样本的数量。

* **成功的样本大小：** 定义前面提到的样本大小，调用原情况所需的成功样本的数目。 例如，假定前门运行状况探测间隔为30秒，样本大小为5，成功的样本大小为3。 每次评估源的运行状况探测时，将在150秒内查看最后五个样本 (5 x 30) 。 至少需要三个成功的探测，才能将原点声明为正常。

* **延迟敏感度 (额外延迟) ：** 定义是否希望 Azure 前门标准/高级版将请求发送到延迟测量敏感度范围内的源，或将请求转发到最近的后端。

有关详细信息，请参阅 [基于延迟的最小路由方法](#latency)。

## <a name="routing-methods"></a>路由方法

Azure 前门标准版/高级版支持不同种类的流量路由方法，以确定如何将 HTTP/HTTPS 流量路由到不同的服务终结点。 当客户端请求到达前门时，将应用配置的路由方法，以确保将请求转发到最佳后端实例。 

Azure 前门标准/高级版中提供了四种流量路由方法：

* **[延迟](#latency)：** 基于延迟的路由确保将请求发送到在敏感度范围内可接受的最低延迟的后端。 基本上，用户请求将发送到 "最近" 的后端集，这与网络延迟有关。
* **[优先级](#priority)：** 如果要将主后端配置为服务所有流量，则可以将优先级分配给后端。 辅助后端可以为备份，以防主后端不可用。
* **[加权](#weighted)：** 如果要将流量分配到一组后端，可以为后端分配权重。 是要均匀分配还是根据权重系数。

所有 Azure 前门标准/高级配置包括对后端运行状况和自动即时全局故障转移的监视。 有关详细信息，请参阅 [后端监视](concept-health-probes.md)。 您的前门可以基于单一路由方法工作。 但根据应用程序的需要，你还可以结合使用多种路由方法来构建最佳路由拓扑。

### <a name="lowest-latencies-based-traffic-routing"></a><a name = "latency"></a>基于最低延迟的流量路由

在全球两个或更多位置部署后端可以通过将流量路由到与最终用户最接近的目标来改善应用程序的响应能力。 前门配置的默认流量路由方法会将最终用户的请求转发到收到请求的前端环境最近的后端。 此方法与 Azure 前门的任意播结构相结合，可确保每个最终用户根据其位置获得最大的个性化性能。

"最近的" 后端不一定是按地理距离衡量的最接近的后端。 Front Door 通过测量网络延迟来确定最靠近的后端。

下面是整体决策流：

| 可用后端 | 优先级 | 延迟信号（基于运行状况探测） | 权重 |
|-------------| ----------- | ----------- | ----------- |
| 首先，选择已启用并返回运行状况探测 (200 正常) 的所有后端。 如果有六个后端 A、B、C、D、E 和 F，其中 C 不正常，并且禁用了 E。 可用的后端列表为 A、B、D 和 F。  | 接下来，选择可用选项中的顶级优先级后端。 如果后端 A、B 和 D 的优先级为1，而后端 F 的优先级为2。 然后，所选后端将为 A、B 和 D。| 选择在延迟范围内的后端（最小延迟，根据以毫秒为单位指定的延迟敏感度确定）。 如果后端 A 是15毫秒，则 B 为30毫秒，而 D 60 ms 离开前门环境（其中，请求着陆和延迟敏感度为 30 ms），最小延迟池包含后端 A 和 B，因为 D 超出最近的后端。 | 最后，Front Door 将会根据指定的权重比，在最终选择的后端池之间轮循流量。 假设后端 A 的权重为 5，后端 B 的权重为 8，则流量将按 5:8 的比在后端 A 与 B 之间分配。 |

>[!NOTE]
> 默认情况下，延迟敏感度属性设置为 0 毫秒，即，始终将请求转发到最快的可用后端。

### <a name="priority-based-traffic-routing"></a><a name = "priority"></a>基于优先级的流量路由

通常，组织希望通过在主服务器出现故障时部署多个备份服务来为其服务提供高可用性。 在整个行业中，此拓扑也称为“主动/后备”或“主动/被动”部署拓扑。 Azure 客户可以通过“优先级”流量路由方法来轻松实现此故障转移模式。

默认的 Front Door 包含后端的均等优先级列表。 默认情况下，Front Door 只将流量发送到最高优先级后端（优先级值最小），即主要后端集。 如果主后端不可用，前门会将流量路由到后端的辅助集 (第二个最低值为优先级) 。 如果主要和辅助后端都不可用，则流量将转到第三个，依此类推。 后端可用性基于配置的状态（已启用或已禁用），持续的后端运行状况由运行状况探测确定。

#### <a name="configuring-priority-for-backends"></a>配置后端的优先级

前端配置的后端池中的每个后端都有一个名为 "Priority" 的属性，它可以是介于1和5之间的数字。 使用 Azure 前门，你可以使用此属性为每个后端显式配置后端优先级。 此属性是介于 1 和 5 之间的值。 值越小，优先级越高。 后端可以共享优先级值。

### <a name="weighted-traffic-routing-method"></a><a name = "weighted"></a>加权流量路由方法
使用“加权”流量路由方法可以均匀分布流量，或使用预定义的权重。

在加权流量路由方法中，需将一个权重分配到后端池的 Front Door 配置中的每个后端。 该权重是从 1 到 1000 的整数。 此参数使用默认权重“50”。

使用具有可接受的延迟敏感度的可用后端的列表，流量将使用指定权重的比率与循环机制一起分发。 如果延迟敏感性设置为0毫秒，则除非有两个后端具有相同网络延迟，否则此属性不会生效。 

加权方法可以实现一些有用的方案：

* **逐步应用程序升级**：提供路由到新后端的流量百分比，并随着时间的推移逐渐增加流量，使其与其他后端。
* **将应用程序迁移到 Azure**：创建包含 Azure 后端和外部后端的后端池。 调整后端权重，以优先选择新的后端。 可以采用渐进式的设置方式：一开始禁用新后端，然后为它们分配最低权重，再慢慢地将权重提高到接收最多流量的级别。 最后，禁用优先级最低的后端，并从池中删除它们。  
* **执行云喷发式部署以增加容量**：通过将本地部署放在 Front Door 的后面，快速将其扩展到云中。 需要在云中获取更多的容量时，可以添加或启用更多后端，并指定哪部分流量将流向每个后端。

## <a name="next-steps"></a>后续步骤

了解如何 [创建前门标准/高级](create-front-door-portal.md)
